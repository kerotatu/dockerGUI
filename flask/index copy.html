 <html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
  <body>
 <div id="container">
      <svg xmlns="http://www.w3.org/2000/svg" width="1000px" height="1000px" viewBox="0 0 1000 1000" @click.left="append">
        <g id="surface1">
          <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 36.453125 0.09375 C 36.1875 0.1875 1.113281 20.390625 0.664062 20.703125 C 0.492188 20.820312 0.273438 21.070312 0.179688 21.257812 L 0 21.585938 L 0 83.476562 L 0.1875 83.867188 C 0.703125 84.960938 2.089844 86.757812 3.679688 88.390625 C 8.789062 93.640625 16.828125 98.09375 23.789062 99.523438 C 25.644531 99.90625 27.90625 100.101562 28.445312 99.921875 C 28.742188 99.828125 63.730469 79.703125 64.304688 79.296875 C 64.476562 79.179688 64.695312 78.929688 64.789062 78.742188 L 64.96875 78.414062 L 64.96875 47.46875 C 64.96875 17.546875 64.960938 16.515625 64.820312 16.210938 C 64.742188 16.039062 64.59375 15.820312 64.492188 15.726562 C 64.289062 15.539062 37.855469 0.289062 37.421875 0.109375 C 37.125 -0.015625 36.765625 -0.0234375 36.453125 0.09375 Z M 49.15625 10.15625 C 55.824219 14 61.289062 17.164062 61.289062 17.1875 C 61.289062 17.210938 61.03125 17.375 60.71875 17.554688 C 59.363281 18.335938 40.125 29.421875 32.390625 33.882812 C 27.269531 36.835938 27.90625 36.578125 26.183594 36.367188 C 24.140625 36.125 22.917969 35.835938 20.625 35.0625 C 16.078125 33.539062 11.050781 30.679688 7.289062 27.476562 C 6.082031 26.453125 4.367188 24.695312 3.585938 23.679688 C 3.203125 23.195312 2.894531 22.773438 2.894531 22.75 C 2.902344 22.664062 36.8125 3.132812 36.921875 3.148438 C 36.976562 3.15625 42.480469 6.3125 49.15625 10.15625 Z M 62.074219 47.867188 L 62.066406 77.304688 L 45.507812 86.835938 C 36.40625 92.078125 28.921875 96.382812 28.882812 96.390625 C 28.828125 96.414062 28.804688 86.296875 28.804688 67.015625 L 28.8125 37.617188 L 45.1875 28.179688 C 54.191406 22.992188 61.671875 18.679688 61.796875 18.601562 C 61.929688 18.515625 62.042969 18.445312 62.058594 18.445312 C 62.066406 18.4375 62.074219 31.679688 62.074219 47.867188 Z M 5.949219 28.234375 C 11.097656 32.742188 18.066406 36.320312 23.992188 37.507812 C 25.085938 37.726562 26.324219 37.890625 26.863281 37.890625 L 27.316406 37.890625 L 27.316406 97.117188 L 26.871094 97.070312 C 24.132812 96.773438 21.574219 96.109375 18.730469 94.945312 C 17.300781 94.359375 14.652344 93.015625 13.148438 92.117188 C 8.867188 89.546875 5.402344 86.492188 3.3125 83.460938 L 2.894531 82.859375 L 2.894531 35.398438 L 3.789062 36.351562 C 6.089844 38.820312 9.386719 41.398438 12.640625 43.273438 C 13.785156 43.9375 16.3125 45.164062 17.605469 45.695312 C 19.175781 46.335938 21.472656 47.085938 23.121094 47.5 C 24.679688 47.890625 24.914062 47.882812 25.148438 47.40625 C 25.273438 47.148438 25.28125 47.09375 25.171875 46.851562 C 25.03125 46.5 24.921875 46.445312 23.898438 46.210938 C 18.675781 44.984375 13.285156 42.414062 9 39.109375 C 7.40625 37.875 5.957031 36.554688 4.390625 34.898438 C 4.046875 34.546875 3.75 34.296875 3.648438 34.289062 C 3.34375 34.273438 3.171875 34.3125 3.035156 34.429688 C 2.902344 34.546875 2.894531 34.328125 2.894531 29.882812 L 2.894531 25.21875 L 3.976562 26.335938 C 4.5625 26.945312 5.457031 27.804688 5.949219 28.234375 Z M 5.949219 28.234375 "/>
          <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 3.546875 41.640625 C 3.453125 41.679688 3.320312 41.8125 3.257812 41.9375 C 3.011719 42.40625 3.164062 42.617188 4.835938 44.296875 C 6.855469 46.304688 8.140625 47.375 10.316406 48.859375 C 13.675781 51.148438 17.402344 52.960938 21.332031 54.195312 C 22.589844 54.585938 24.5625 55.078125 24.898438 55.078125 C 25.472656 55.078125 25.792969 54.53125 25.519531 54.023438 C 25.394531 53.796875 25.242188 53.734375 24.0625 53.445312 C 18.207031 52.023438 12.695312 49.226562 8.023438 45.328125 C 7.640625 45 6.605469 44.023438 5.730469 43.148438 C 4.0625 41.484375 4.015625 41.453125 3.546875 41.640625 Z M 3.546875 41.640625 "/>
          <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 6.574219 63 C 5.574219 63.28125 4.773438 64.0625 4.328125 65.210938 C 4.148438 65.671875 4.117188 65.859375 4.117188 66.601562 C 4.117188 67.367188 4.140625 67.515625 4.335938 68.007812 C 4.953125 69.507812 5.957031 70.257812 7.359375 70.265625 C 7.945312 70.273438 8.085938 70.242188 8.53125 70.03125 C 9.183594 69.726562 9.574219 69.382812 9.957031 68.796875 C 10.941406 67.273438 10.753906 65.132812 9.527344 63.84375 C 8.765625 63.054688 7.59375 62.71875 6.574219 63 Z M 8.132812 64.335938 C 8.5625 64.546875 8.921875 64.960938 9.175781 65.523438 C 9.410156 66.039062 9.410156 67.140625 9.183594 67.65625 C 8.90625 68.257812 8.570312 68.640625 8.132812 68.859375 C 7.164062 69.335938 6.222656 68.96875 5.628906 67.875 C 5.378906 67.40625 5.363281 67.34375 5.363281 66.601562 C 5.371094 65.96875 5.402344 65.75 5.535156 65.46875 C 6.089844 64.304688 7.15625 63.835938 8.132812 64.335938 Z M 8.132812 64.335938 "/>
          <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 6.402344 72.601562 C 5.246094 73.039062 4.460938 74 4.171875 75.335938 C 3.976562 76.265625 4.148438 77.242188 4.664062 78.09375 C 5.152344 78.90625 5.691406 79.335938 6.527344 79.570312 C 7.75 79.921875 9.207031 79.28125 9.894531 78.109375 C 10.386719 77.257812 10.550781 75.976562 10.300781 75.03125 C 10.042969 74.070312 9.363281 73.195312 8.554688 72.796875 C 8.117188 72.585938 7.945312 72.546875 7.367188 72.523438 C 6.933594 72.507812 6.589844 72.539062 6.402344 72.601562 Z M 7.703125 73.78125 C 8.203125 73.929688 8.570312 74.226562 8.835938 74.703125 C 9.410156 75.695312 9.308594 76.96875 8.585938 77.78125 C 7.640625 78.851562 6.214844 78.570312 5.566406 77.1875 C 5.277344 76.570312 5.277344 75.617188 5.566406 75 C 5.910156 74.265625 6.316406 73.890625 6.925781 73.742188 C 7.273438 73.664062 7.304688 73.664062 7.703125 73.78125 Z M 7.703125 73.78125 "/>
        </g>
        <circle v-for="(circle,index) in circles":cx="circle.cx" :cy="circle.cy" :r="circle.r" :stroke="circle.stroke" stroke-width="5" @click.right.prevent="remove(index)" @click.stop.left="drawLine(index)"/>
        <text v-for="(circle,index) in circles":x="circle.cx"  :y="circle.cy+circle.r+15 ":length="2">{{circle.id}}</text>
        <line v-for="line in lines":x1="line.x1":x2="line.x2":y1="line.y1":y2="line.y2"stroke="black"/>
        
      </svg>    
      <button @click="dlCSV">
        ダウンロード
      </button>
      <button @click="postTest">送信</button>
  </div>
<script>
   new Vue({
    el : "#container",
    data() {
      return {
        num:1,
        firstClick:true,
        clickedCircle:-1,
        changeIndex:0,
        lineIndex:0,
        id:0,
        tmpx:0,
        tmpy:0,
        serverCoor:[
          {x:0,y:0}
        ],
        circles : [
           {cx:0, cy:0, r:0,id:0,stroke:"black"}
        ],
        lines :[
          {x1:0, x2:0, y1:0, y2:0, pathLength:0}
        ],
        containers:[
          {id:0 ,name:""}
        ],
        relation:[
          {from:"" ,to:"" ,num:0}
        ],
      }
    },
    methods: {
      append:function(e){
        
        this.circles.push({
          cx : e.offsetX,
          cy : e.offsetY,
          r  : 50,
          id : this.num++,
          stroke:"black"
        });
      },
      remove:function(index){
        this.circles.splice(index,1)
        
      },
      drawLine:function(circleIndex){
        if(this.firstClick){
        this.circles[circleIndex]["stroke"]="blue"
        this.relation.push({
          from:circleIndex,
          to:null,
          num:null
        }
        
        )
        console.log("push")
        this.tmpx=this.circles[circleIndex]["cx"]
        this.tmpy=this.circles[circleIndex]["cy"]
        this.firstClick=false
        this.clickedCircle=circleIndex
      }else{
        this.relation[this.lineIndex+1]["to"]=circleIndex
        this.lines.push({
          x1:this.tmpx,
          x2:this.circles[circleIndex]["cx"],
          y1:this.tmpy,
          y2:this.tmpy=this.circles[circleIndex]["cy"]
        })
        this.firstClick=true
        this.lineIndex++
        this.circles[this.clickedCircle]["stroke"]="black"
        console.log("a")
        
      }

      },
      dlCSV () {
      var csv = '\ufeff' + 'from,to\n'
      this.relation.forEach(el => {
        var line = el['from'] + ',' + el['to'] + '\n'
        csv += line
      })
      let blob = new Blob([csv], { type: 'text/csv' })
      let link = document.createElement('a')
      link.href = window.URL.createObjectURL(blob)
      link.download = 'Result.csv'
      link.click()
    },
    postTest: function(){
            console.log("aaaa")
            console.log(this.relation[1]["to"])
            axios.post('http://127.0.0.1:12345/postTest',this.relation)
           .then(function (response) {
            console.log(response);
            })
            .catch(function (error) {
             console.log(error);
  });
          },
    }
   });
   </script>
   </body>
   </html>